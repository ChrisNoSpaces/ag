<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Location Zone Manager</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #22d3ee;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-light: #e2e8f0;
            --text-muted: #94a3b8;
        }
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
            color: var(--text-light);
            min-height: 100vh;
        }
        #map {
            height: 60vh;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .zone-label {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .zone-label:hover {
            transform: scale(1.02);
        }
        .location-row {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 8px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .location-row:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        input, select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px 14px;
            color: white;
            width: 100%;
            transition: all 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .zone-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 8px;
        }
        .leaflet-popup-content-wrapper {
            background: var(--bg-card);
            color: var(--text-light);
            border-radius: 12px;
        }
        .leaflet-popup-tip {
            background: var(--bg-card);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <!-- Login Modal -->
    <div id="loginModal" class="modal active">
        <div class="modal-content animate-fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">üó∫Ô∏è Zone Manager</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter username">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password">
                </div>
                <button onclick="login()" class="btn-primary w-full py-3 rounded-xl font-semibold">
                    Login
                </button>
                <div class="text-center text-gray-400">or</div>
                <button onclick="continueAsGuest()" class="btn-secondary w-full py-3 rounded-xl font-semibold">
                    Continue as Guest
                </button>
                <button onclick="showCreateAccount()" class="text-indigo-400 hover:text-indigo-300 w-full text-center text-sm">
                    Create an Account
                </button>
            </div>
            <p id="loginError" class="text-red-400 text-sm mt-4 text-center hidden"></p>
        </div>
    </div>

    <!-- Create Account Modal -->
    <div id="createAccountModal" class="modal">
        <div class="modal-content animate-fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">Create Account</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Username</label>
                    <input type="text" id="newUsername" placeholder="Choose username">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Password</label>
                    <input type="password" id="newPassword" placeholder="Choose password">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm password">
                </div>
                <button onclick="createAccount()" class="btn-primary w-full py-3 rounded-xl font-semibold">
                    Create Account
                </button>
                <button onclick="backToLogin()" class="btn-secondary w-full py-3 rounded-xl font-semibold">
                    Back to Login
                </button>
            </div>
            <p id="createError" class="text-red-400 text-sm mt-4 text-center hidden"></p>
        </div>
    </div>

    <!-- Edit Location Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content animate-fade-in">
            <h2 class="text-2xl font-bold mb-6">Edit Location</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Business Name</label>
                    <input type="text" id="editName" placeholder="Business name">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Address</label>
                    <input type="text" id="editAddress" placeholder="Full address">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Latitude</label>
                        <input type="number" step="any" id="editLat" placeholder="Latitude">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Longitude</label>
                        <input type="number" step="any" id="editLng" placeholder="Longitude">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Zone Assignment</label>
                    <select id="editZone">
                        <option value="auto">Auto-assign</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-4">
                    <button onclick="saveEdit()" class="btn-primary flex-1 py-3 rounded-xl font-semibold">
                        Save Changes
                    </button>
                    <button onclick="closeEditModal()" class="btn-secondary flex-1 py-3 rounded-xl font-semibold">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Location Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content animate-fade-in">
            <h2 class="text-2xl font-bold mb-6">Add New Location</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Business Name</label>
                    <input type="text" id="addName" placeholder="Business name">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Address</label>
                    <input type="text" id="addAddress" placeholder="Full address">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Latitude (optional)</label>
                        <input type="number" step="any" id="addLat" placeholder="Auto-detect">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Longitude (optional)</label>
                        <input type="number" step="any" id="addLng" placeholder="Auto-detect">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Zone Assignment</label>
                    <select id="addZone">
                        <option value="auto">Auto-assign</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-4">
                    <button onclick="addLocation()" class="btn-primary flex-1 py-3 rounded-xl font-semibold">
                        Add Location
                    </button>
                    <button onclick="closeAddModal()" class="btn-secondary flex-1 py-3 rounded-xl font-semibold">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone Management Modal -->
    <div id="zoneModal" class="modal">
        <div class="modal-content animate-fade-in">
            <h2 class="text-2xl font-bold mb-6">Zone Management</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Number of Zones</label>
                    <input type="number" id="zoneCount" min="1" max="50" value="25">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Max Addresses per Zone</label>
                    <input type="number" id="maxPerZone" min="1" value="20">
                </div>
                <div id="zoneList" class="max-h-60 overflow-y-auto scrollbar-thin space-y-2">
                    <!-- Zone list will be populated here -->
                </div>
                <div class="flex gap-3 pt-4">
                    <button onclick="applyZoneSettings()" class="btn-primary flex-1 py-3 rounded-xl font-semibold">
                        Apply & Recalibrate
                    </button>
                    <button onclick="closeZoneModal()" class="btn-secondary flex-1 py-3 rounded-xl font-semibold">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="mainApp" class="hidden">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">
                    Zone Manager
                </h1>
                <p class="text-gray-400 mt-1">Logged in as: <span id="currentUser" class="text-indigo-400"></span></p>
            </div>
            <div class="flex gap-3 flex-wrap">
                <button onclick="showZoneModal()" class="btn-secondary px-4 py-2 rounded-xl text-sm font-medium">
                    ‚öôÔ∏è Zone Settings
                </button>
                <button onclick="logout()" class="btn-secondary px-4 py-2 rounded-xl text-sm font-medium">
                    üö™ Logout
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Map Section -->
            <div class="lg:col-span-3">
                <div class="glass-card p-4">
                    <div id="map"></div>
                </div>
            </div>

            <!-- Zone Legend -->
            <div class="glass-card p-4 max-h-[60vh] overflow-y-auto scrollbar-thin">
                <h3 class="text-lg font-semibold mb-4">Zones</h3>
                <div id="zoneLegend"></div>
            </div>
        </div>

        <!-- Locations Panel -->
        <div class="glass-card p-6 mt-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <h3 class="text-xl font-semibold">All Locations</h3>
                <div class="flex gap-3 flex-wrap items-center">
                    <div class="flex items-center gap-2">
                        <label class="text-sm text-gray-400">Sort by:</label>
                        <select id="sortBy" onchange="sortLocations()" class="py-2 px-3">
                            <option value="name">Name</option>
                            <option value="zone">Zone</option>
                            <option value="address">Address</option>
                        </select>
                    </div>
                    <input type="text" id="searchInput" placeholder="Search locations..." 
                           onkeyup="filterLocations()" class="py-2 px-3 w-48">
                    <button onclick="showAddModal()" class="btn-primary px-4 py-2 rounded-xl text-sm font-medium">
                        ‚ûï Add Address
                    </button>
                </div>
            </div>
            <div id="locationsList" class="max-h-96 overflow-y-auto scrollbar-thin space-y-2"></div>
        </div>
    </div>

    <script>
        // Pre-loaded locations for chris/beaver account
        const preloadedLocations = [
            {name: "Capital Flooring Inc", address: "46969 West Rd, Wixom, MI 48393", lat: 42.527489, lng: -83.545900},
            {name: "Leslie McGwire & Associates", address: "4301 Orchard Lake Rd, West Bloomfield Township, MI 48323", lat: 42.555501, lng: -83.375536},
            {name: "Gumma Group", address: "7419 Middlebelt Rd # 4, West Bloomfield Township, MI 48322", lat: 42.554729, lng: -83.376466},
            {name: "DKI Demolition", address: "6775 Daly Rd Suite#101, West Bloomfield Township, MI 48322", lat: 42.557844, lng: -83.388261},
            {name: "Independence Commercial Construction", address: "Inc.,2635 Dixie Hwy, Waterford Township, MI 48328", lat: 42.668438, lng: -83.409404},
            {name: "Wolverine Stone Co", address: "27270 Gloede Dr, Warren, MI 48088", lat: 42.487773, lng: -82.972493},
            {name: "Wakely Associates", address: "30500 Van Dyke Ave, Warren, MI 48093", lat: 42.510531, lng: -83.026023},
            {name: "Villa Carpets", address: "Inc,30000 Ryan Rd, Warren, MI 48092", lat: 42.512998, lng: -82.999101},
            {name: "Son Shine Floor Covering", address: "31065 Ryan Rd, Warren, MI 48092", lat: 42.504409, lng: -82.998215},
            {name: "Ross & Barr Inc", address: "11800 E 9 Mile Rd, Warren, MI 48089", lat: 42.506189, lng: -82.999870},
            {name: "Motor City Carpet & Flooring", address: "23957 Ryan Rd, Warren, MI 48091", lat: 42.491116, lng: -83.011037},
            {name: "MGC Granite & Design", address: "14230 E 11 Mile Rd, Warren, MI 48089", lat: 42.496805, lng: -82.996890},
            {name: "Dapco Central Operations Office", address: "11020 E 9 Mile Rd, Warren, MI 48089", lat: 42.509144, lng: -82.993268},
            {name: "Creative Building & Remodeling", address: "26820 Dequindre Rd, Warren, MI 48091", lat: 42.476855, lng: -83.023066},
            {name: "Brencal Contractors Inc", address: "26079 Schoenherr Rd, Warren, MI 48089", lat: 42.506950, lng: -82.987925},
            {name: "Stonescape Supply", address: "4454 22 Mile Rd, Shelby Township, MI 48317", lat: 42.616143, lng: -83.035405},
            {name: "Beninati Custom Pools", address: "Swim Spas and Hot Tubs,6991 Auburn Rd, Utica, MI 48317", lat: 42.610725, lng: -83.030538},
            {name: "Zac Cruse Construction Company", address: "4150 Lincoln St, Detroit, MI 48208", lat: 42.337571, lng: -83.078959},
            {name: "Your Choice Flooring Inc", address: "1409 Allen Dr # E, Troy, MI 48083", lat: 42.586888, lng: -83.147030},
            {name: "Ruth Casper Design Studio", address: "1700 Stutz Dr # 102E, Troy, MI 48084", lat: 42.572234, lng: -83.128453},
            {name: "Quality Tile", address: "3331 Gerald Ave, Rochester Hills, MI 48307", lat: 42.662691, lng: -83.158984},
            {name: "PMP Marble & Granite", address: "1360 E Big Beaver Rd, Troy, MI 48083", lat: 42.574858, lng: -83.153612},
            {name: "Peter Basso Associates Inc", address: "5145 Livernois Rd #100, Troy, MI 48098", lat: 42.601596, lng: -83.165344},
            {name: "Office Express", address: "1280 E Big Beaver Rd, Troy, MI 48083", lat: 42.572320, lng: -83.153841},
            {name: "National Business Supply", address: "2595 Bellingham Rd, Troy, MI 48083", lat: 42.583014, lng: -83.152103},
            {name: "Mondrian Properties LLC.", address: "2113 Kohli Dr, Troy, MI 48083", lat: 42.577704, lng: -83.155210},
            {name: "M & N General Contracting LLC", address: "972 Rankin St, Troy, MI 48083", lat: 42.575640, lng: -83.140667},
            {name: "Michigan Multi-King Inc", address: "4897 Rochester Rd, Troy, MI 48085", lat: 42.602961, lng: -83.117817},
            {name: "Joseph Philip Craig Inc", address: "2025 W Long Lake Rd, Troy, MI 48098", lat: 42.603423, lng: -83.155417},
            {name: "Integrated Design Solutions", address: "1441 W Long Lake Rd #200, Troy, MI 48098", lat: 42.603268, lng: -83.162411},
            {name: "Gold Star Commercial", address: "INC,264 Executive Dr, Troy, MI 48083", lat: 42.590090, lng: -83.146600},
            {name: "Gio-Con", address: "2145 Crooks Rd #210, Troy, MI 48084", lat: 42.566139, lng: -83.126308},
            {name: "Gillete Brothers Pool & Spa", address: "392 Oliver, Troy, MI 48084", lat: 42.571857, lng: -83.124480},
            {name: "Fairview Construction", address: "1700 W Big Beaver Rd #120, Troy, MI 48084", lat: 42.559581, lng: -83.139358},
            {name: "Excel Floors", address: "Inc,1715 Larchwood Ave, Troy, MI 48083", lat: 42.576609, lng: -83.154045},
            {name: "Ehresman Architects", address: "801 W Big Beaver Rd #250, Troy, MI 48084", lat: 42.559220, lng: -83.121142},
            {name: "Cutting Edge Stonecraft", address: "Inc.,24420 Indoplex Cir, Farmington Hills, MI 48335", lat: 42.477527, lng: -83.393706},
            {name: "Continental Interiors Inc", address: "1210 E Maple Rd, Troy, MI 48083", lat: 42.583409, lng: -83.151487},
            {name: "BEI Architects", address: "1333 Rochester Rd, Troy, MI 48083", lat: 42.588591, lng: -83.150223},
            {name: "Eldorado Tile & Marble", address: "6506 Cotter Ave, Sterling Heights, MI 48314", lat: 42.605298, lng: -83.015067},
            {name: "Stone Warehouse USA - Michigan", address: "7235 19 Mile Rd, Sterling Heights, MI 48314", lat: 42.611227, lng: -83.014745},
            {name: "PMS Brick Pavers We\'re The Guys", address: "5540 Bridgewood Dr, Sterling Heights, MI 48310", lat: 42.581692, lng: -83.022044},
            {name: "Majestic Home Solutions LLC", address: "42886 Mound Rd, Sterling Heights, MI 48314", lat: 42.607988, lng: -83.015614},
            {name: "Floorz Supplies Plus INC", address: "34832 Mound Rd, Sterling Heights, MI 48310", lat: 42.589951, lng: -83.029809},
            {name: "Floor 4 Life", address: "34800 Mound Rd, Sterling Heights, MI 48310", lat: 42.571818, lng: -83.039058},
            {name: "Eastside Tile And Marble", address: "42700 Mound Rd, Sterling Heights, MI 48314", lat: 42.602193, lng: -83.007451},
            {name: "Great Lakes Tile & Contracting", address: "42730 Mound Rd, Sterling Heights, MI 48314", lat: 42.615842, lng: -83.011557},
            {name: "DAS Architects", address: "7341 Triangle Dr, Sterling Heights, MI 48314", lat: 42.601271, lng: -83.012368},
            {name: "The Cabinet Shoppe", address: "32303 Harper Ave, St Clair Shores, MI 48082", lat: 42.529922, lng: -82.859418},
            {name: "Woodmaster Kitchens of Michigan", address: "24420 Harper Ave, St Clair Shores, MI 48080", lat: 42.499422, lng: -82.882784},
            {name: "Red Baron Enterprises", address: "20315 E 9 Mile Rd, St Clair Shores, MI 48080", lat: 42.480230, lng: -82.885586},
            {name: "Rabaut\'s Interiors", address: "19513 Mack Ave, Grosse Pointe Woods, MI 48236", lat: 42.413634, lng: -82.889261},
            {name: "North American Construction Enterprises", address: "LLC,22920 E Industrial Dr, St Clair Shores, MI 48080", lat: 42.485337, lng: -82.887181},
            {name: "Arkay-Walker Paint and Interior Design", address: "27110 Harper Ave, St Clair Shores, MI 48081", lat: 42.492231, lng: -82.881305},
            {name: "ZeinaDesigns", address: "29145 Telegraph Rd, Southfield, MI 48034", lat: 42.484074, lng: -83.255924},
            {name: "Lockwood Companies", address: "27777 Franklin Rd #1410, Southfield, MI 48034", lat: 42.492517, lng: -83.269732},
            {name: "Land Design Studio", address: "18161 13 Mile Rd # B4, Southfield, MI 48076", lat: 42.470012, lng: -83.256427},
            {name: "GREENWORKS Studio", address: "28411 Northwestern Hwy #320, Southfield, MI 48034", lat: 42.493253, lng: -83.257590},
            {name: "Tableau", address: "50215 Schoenherr Rd, Shelby Township, MI 48315", lat: 42.665969, lng: -82.947221},
            {name: "Szczesny Floor Covering", address: "14240 Industrial Center Dr, Shelby Township, MI 48315", lat: 42.672179, lng: -82.956943},
            {name: "Shelby Floor and Tile", address: "46511 Van Dyke Ave, Shelby Township, MI 48317", lat: 42.615250, lng: -83.039212},
            {name: "J M P Design & Build Inc.", address: "51456 Oro Rd, Shelby Township, MI 48315", lat: 42.675573, lng: -82.949393},
            {name: "Bobak Construction LLC", address: "54441 Arrowhead Dr, Shelby Township, MI 48315", lat: 42.660011, lng: -82.953517},
            {name: "Frank Salamone", address: "48701 Hayes Rd, Shelby Township, MI 48315", lat: 42.660390, lng: -82.941418},
            {name: "Anderson", address: "Eckstein & Westrick, Inc.,51301 Schoenherr Rd, Shelby Township, MI 48315", lat: 42.677574, lng: -82.943367},
            {name: "Nu-Way Kitchen & Bath", address: "5227 Auburn Rd, Shelby Township, MI 48317", lat: 42.606150, lng: -83.048841},
            {name: "Xstyles bath+more", address: "4812 Delemere Ave, Royal Oak, MI 48076", lat: 42.477560, lng: -83.241061},
            {name: "Wightman - Royal Oak", address: "306 S Washington Ave Suite 200, Royal Oak, MI 48067", lat: 42.481213, lng: -83.144880},
            {name: "Whiski Kitchen Design Studio", address: "1201 N Main St, Royal Oak, MI 48067", lat: 42.480884, lng: -83.139388},
            {name: "Von Staden Architects", address: "504 S Washington Ave, Royal Oak, MI 48067", lat: 42.494817, lng: -83.152032},
            {name: "TVI Inc.", address: "28966 Woodward Ave, Royal Oak, MI 48067", lat: 42.489006, lng: -83.143604},
            {name: "Space Care Interiors", address: "210 W 6th St, Royal Oak, MI 48067", lat: 42.484801, lng: -83.137151},
            {name: "Shelter Design Studio", address: "104 W 4th St #303, Royal Oak, MI 48067", lat: 42.487963, lng: -83.150364},
            {name: "Richard Ross Designs", address: "2051 Villa Rd #104, Birmingham, MI 48009", lat: 42.547486, lng: -83.206701},
            {name: "R J Laney Design", address: "4535 Fernlee Ave, Royal Oak, MI 48073", lat: 42.504023, lng: -83.173766},
            {name: "PARTNR HAUS Commercial Interiors", address: "2120 E 11 Mile Rd, Royal Oak, MI 48067", lat: 42.499403, lng: -83.141602},
            {name: "Mosher Dolan", address: "2725 Nakota Rd, Royal Oak, MI 48073", lat: 42.508762, lng: -83.169648},
            {name: "Moiseev-Gordon & Associates Inc", address: "4351 Delemere Ct, Royal Oak, MI 48073", lat: 42.502420, lng: -83.175506},
            {name: "Live Well Custom Homes", address: "626 E 4th St, Royal Oak, MI 48067", lat: 42.486262, lng: -83.142834},
            {name: "Krieger Klatt Architects", address: "400 E Lincoln Ave, Royal Oak, MI 48067", lat: 42.484102, lng: -83.150196},
            {name: "Jeff Dawkins . Architect", address: "2565 W Maple Rd #101, Troy, MI 48084", lat: 42.556420, lng: -83.127378},
            {name: "italmoda Modern Furniture", address: "950 W Maple Rd, Troy, MI 48084", lat: 42.559579, lng: -83.121892},
            {name: "ISCG - Haworth Dealer", address: "612 N Main St, Royal Oak, MI 48067", lat: 42.496693, lng: -83.153183},
            {name: "GMB", address: "1041 S Main St #200, Royal Oak, MI 48067", lat: 42.484260, lng: -83.141220},
            {name: "G H Forbes Associates", address: "816 E 4th St, Royal Oak, MI 48067", lat: 42.483785, lng: -83.151954},
            {name: "Executive Kitchens", address: "Inc,32314 Woodward Ave, Royal Oak, MI 48073", lat: 42.518710, lng: -83.168579},
            {name: "Detroit Build", address: "Inc.,1201 N Main St, Royal Oak, MI 48067", lat: 42.488953, lng: -83.138908},
            {name: "D MET studio architecture and design", address: "832 W 11 Mile Rd, Royal Oak, MI 48067", lat: 42.495650, lng: -83.150792},
            {name: "Comprehensive Design Group", address: "628 E Parent Ave #103, Royal Oak, MI 48067", lat: 42.481439, lng: -83.145979},
            {name: "Building Detail", address: "1600 Rochester Rd, Royal Oak, MI 48067", lat: 42.487972, lng: -83.145260},
            {name: "Bourlier\'s Barbecue and Fireplace Inc.", address: "32128 Woodward Ave, Royal Oak, MI 48073", lat: 42.514582, lng: -83.166533},
            {name: "Art-Harrison Interior Design", address: "4339 Delemere Blvd, Royal Oak, MI 48073", lat: 42.519683, lng: -83.178032},
            {name: "Anderson-Miller", address: "123 S Main St #230, Royal Oak, MI 48067", lat: 42.487552, lng: -83.147814},
            {name: "Shores Tile Co", address: "29975 Little Mack Ave, Roseville, MI 48066", lat: 42.507233, lng: -82.935027},
            {name: "Shock Brothers Floor Covering", address: "20320 Cornillie Dr, Roseville, MI 48066", lat: 42.493804, lng: -82.931028},
            {name: "Serra-Marko & Associates", address: "1055 E South Blvd, Rochester Hills, MI 48307", lat: 42.657038, lng: -83.154329},
            {name: "Perfect Floors", address: "1015 John R Rd, Rochester Hills, MI 48307", lat: 42.653596, lng: -83.141435},
            {name: "Bolyard Lumber & Design", address: "3770 S Rochester Rd, Rochester Hills, MI 48307", lat: 42.657463, lng: -83.142673},
            {name: "Mercury Project", address: "1806 Rochester Industrial Dr #200, Rochester Hills, MI 48309", lat: 42.681007, lng: -83.128988},
            {name: "Luxury Tile & Marble Co", address: "3675 W Auburn Rd, Rochester Hills, MI 48309", lat: 42.689986, lng: -83.113279},
            {name: "L+A Architects", address: "441 S Livernois Rd #265, Rochester Hills, MI 48307", lat: 42.667980, lng: -83.141373},
            {name: "EEI Global", address: "1601 W Hamlin Rd, Rochester Hills, MI 48309", lat: 42.686974, lng: -83.126674},
            {name: "Design by Choice LLC", address: "1700 Stutz Dr #104A, Troy, MI 48084", lat: 42.564713, lng: -83.135725},
            {name: "D\'Anna Associates", address: "1055 E South Blvd #200, Rochester Hills, MI 48307", lat: 42.656621, lng: -83.158727},
            {name: "Spire Design Group", address: "115 E 4th St, Rochester, MI 48307", lat: 42.656179, lng: -83.140194},
            {name: "Niagara Murano LLC", address: "2215 Cole St, Birmingham, MI 48009", lat: 42.542004, lng: -83.205619},
            {name: "LoChirco Custom Homes", address: "202 Walnut Blvd Suite B, Rochester, MI 48307", lat: 42.657700, lng: -83.151440},
            {name: "Kendal & Company", address: "1429 N Rochester Rd, Rochester Hills, MI 48307", lat: 42.667746, lng: -83.139992},
            {name: "French Associates", address: "236 Mill St, Rochester, MI 48307", lat: 42.659715, lng: -83.145532},
            {name: "DMJ Interiors", address: "312 East St, Rochester, MI 48307", lat: 42.651696, lng: -83.153966},
            {name: "Dillman & Upton", address: "607 Woodward Ave, Rochester, MI 48307", lat: 42.667974, lng: -83.148316},
            {name: "Auger Klein Aller Architects", address: "303 E 3rd St #100, Rochester, MI 48307", lat: 42.659444, lng: -83.144940},
            {name: "TDG Architects", address: "79 Oakland Ave, Pontiac, MI 48342", lat: 42.630043, lng: -83.289416},
            {name: "Studio 5", address: "40 W Howard St, Pontiac, MI 48342", lat: 42.638957, lng: -83.284046},
            {name: "Heller & Associates", address: "7 S Perry St, Pontiac, MI 48342", lat: 42.632049, lng: -83.281884},
            {name: "Sage Home D√©cor", address: "795 S Lapeer Rd, Oxford, MI 48371", lat: 42.816602, lng: -83.270984},
            {name: "All American Floors", address: "1772 S Ortonville Rd, Ortonville, MI 48462", lat: 42.851901, lng: -83.436496},
            {name: "PCI-Dailey Company", address: "21717 Republic Ave, Oak Park, MI 48237", lat: 42.454704, lng: -83.187602},
            {name: "Alexandria Interiors LLC", address: "43155 Main St, Novi, MI 48375", lat: 42.487806, lng: -83.475076},
            {name: "Vistal Homes", address: "46870 W Seven Mile Rd, Northville, MI 48167", lat: 42.431890, lng: -83.477612},
            {name: "Martone Design Studio", address: "120 W Main St, Northville, MI 48167", lat: 42.428384, lng: -83.478327},
            {name: "GTR Companies LLC", address: "65 Macomb Pl, Mt Clemens, MI 48043", lat: 42.597456, lng: -82.869306},
            {name: "Partners in Architecture", address: "PLC,65 Market St #200, Mt Clemens, MI 48043", lat: 42.591085, lng: -82.873676},
            {name: "Blackstock Alessandri Associates Llc", address: "70 Macomb Pl Suite 220, Mt Clemens, MI 48043", lat: 42.591774, lng: -82.880084},
            {name: "Innovative Corporation Int", address: "32384 Edward Ave, Madison Heights, MI 48071", lat: 42.513434, lng: -83.109000},
            {name: "Silva Custom Design LLC", address: "515 E 10 Mile Rd, Madison Heights, MI 48071", lat: 42.506324, lng: -83.099963},
            {name: "NCS Construction Services LLC", address: "876 Horace Brown Dr, Madison Heights, MI 48071", lat: 42.501451, lng: -83.105834},
            {name: "Namou Hotel Group", address: "31100 Stephenson Hwy, Madison Heights, MI 48071", lat: 42.519969, lng: -83.095078},
            {name: "Kitchen & Bath By Rite-Way", address: "32090 John R Rd, Madison Heights, MI 48071", lat: 42.501465, lng: -83.110737},
            {name: "Design Fabrications (DFab)", address: "1100 E Mandoline Ave suite a, Madison Heights, MI 48071", lat: 42.505304, lng: -83.096335},
            {name: "Heritage Oaks", address: "51194 Romeo Plank Rd #453, Macomb, MI 48042", lat: 42.677617, lng: -82.912415},
            {name: "Quicken Stones LLC", address: "44884 Heydenreich Rd, Clinton Township, MI 48038", lat: 42.607391, lng: -82.946845},
            {name: "Musante Tile", address: "48895 Fairchild Rd, Macomb, MI 48042", lat: 42.676675, lng: -82.915929},
            {name: "Hubert Contracting LLC", address: "51410 Milano Dr, Macomb, MI 48042", lat: 42.672234, lng: -82.910255},
            {name: "Cwc Finished Basements", address: "23035 Angel Park Dr, Macomb, MI 48042", lat: 42.673080, lng: -82.929844},
            {name: "Blue Mountain Construction Group", address: "20371 Hall Rd, Macomb, MI 48044", lat: 42.656342, lng: -82.904012},
            {name: "SAA Architects", address: "214 S Broadway St, Lake Orion, MI 48362", lat: 42.787768, lng: -83.230821},
            {name: "AV Design Kitchen + Bath", address: "169w Clarkston Rd Suite 100, Orion Township, MI 48362", lat: 42.777186, lng: -83.247291},
            {name: "Stellar Building and Development", address: "24410 John R Rd, Hazel Park, MI 48030", lat: 42.452141, lng: -83.098936},
            {name: "Designstruct Inc.", address: "23617 John R Rd, Hazel Park, MI 48030", lat: 42.455447, lng: -83.097903},
            {name: "Continental Contracting Co.", address: "LLC,23450 Telegraph Rd, Southfield, MI 48033", lat: 42.472352, lng: -83.290928},
            {name: "Omega Floors", address: "35370 Union Lake Rd, Harrison Township, MI 48045", lat: 42.582685, lng: -82.814720},
            {name: "American Community Developers", address: "20250 Harper Ave, Harper Woods, MI 48225", lat: 42.429771, lng: -82.911893},
            {name: "Steven C Flum Inc", address: "3105 Holbrook, Hamtramck, MI 48212", lat: 42.396922, lng: -83.058154},
            {name: "Nitsas Interiors", address: "20445 Mack Ave, Grosse Pointe Woods, MI 48236", lat: 42.408472, lng: -82.894466},
            {name: "Ann-Marie Anton", address: "1835 Fleetwood Dr, Grosse Pointe Woods, MI 48236", lat: 42.400071, lng: -82.884578},
            {name: "Decor and More Design Studio", address: "319 Fisher Rd, Grosse Pointe, MI 48230", lat: 42.382742, lng: -82.914761},
            {name: "Diane Woolsey Interiors LLC", address: "86 Kercheval Ave, Grosse Pointe Farms, MI 48236", lat: 42.414825, lng: -82.888966},
            {name: "Russo Bennett Associates", address: "34517 Utica Rd, Fraser, MI 48026", lat: 42.538554, lng: -82.959807},
            {name: "Rapid Recovery Service", address: "18377 E 14 Mile Rd, Fraser, MI 48026", lat: 42.531505, lng: -82.942338},
            {name: "32205 Groesbeck Hwy", address: "32205 Groesbeck Hwy, Fraser, MI 48026", lat: 42.548079, lng: -82.949088},
            {name: "CONSTRUCTEAM", address: "31780 Groesbeck Hwy, Fraser, MI 48026", lat: 42.546692, lng: -82.948350},
            {name: "Zoyes Creative - Ferndale", address: "1280 Hilton Rd, Ferndale, MI 48220", lat: 42.452962, lng: -83.137451},
            {name: "Zoyes Creative - Brand Studio", address: "2111 Woodward Ave Suite 400, Detroit, MI 48201", lat: 42.345065, lng: -83.057620},
            {name: "United Building Service Co", address: "2870 Hilton Rd, Ferndale, MI 48220", lat: 42.465922, lng: -83.122786},
            {name: "Towers Interior Group", address: "31500 Northwestern Hwy, Farmington Hills, MI 48334", lat: 42.527978, lng: -83.355798},
            {name: "Northern Equities Group", address: "39000 Country Club Dr, Farmington Hills, MI 48331", lat: 42.484991, lng: -83.387944},
            {name: "MFG Interiors", address: "39255 Country Club Dr, Farmington Hills, MI 48331", lat: 42.495602, lng: -83.372317},
            {name: "Interior Image", address: "37680 Hills Tech Dr, Farmington Hills, MI 48331", lat: 42.488128, lng: -83.377587},
            {name: "Waldorf Floors LLC", address: "24798 Crestview, Farmington Hills, MI 48335", lat: 42.463091, lng: -83.381402},
            {name: "Empire Tile & Marble Co.", address: "17255 Stephens Rd, Eastpointe, MI 48021", lat: 42.477292, lng: -82.950476},
            {name: "Sterling Group", address: "Fort Washington Plaza, 333 W Fort St #1350, Detroit, MI 48226", lat: 42.337615, lng: -83.038172},
            {name: "Scales & Associates Inc", address: "28 W Adams Ave # 1100, Detroit, MI 48226", lat: 42.321896, lng: -83.041069},
            {name: "RVSN Studios", address: "300 Riverfront Dr, Detroit, MI 48226", lat: 42.328044, lng: -83.037184},
            {name: "Resendes Design Group", address: "7451 3rd Ave, Detroit, MI 48202", lat: 42.376045, lng: -83.062719},
            {name: "Redbird Detroit", address: "4474 3rd Ave, Detroit, MI 48201", lat: 42.355115, lng: -83.070264},
            {name: "Populous", address: "19 Clifford St Suite 08-101, Detroit, MI 48226", lat: 42.337147, lng: -83.053638},
            {name: "Pophouse", address: "1150 Griswold St, Detroit, MI 48226", lat: 42.338843, lng: -83.038628},
            {name: "NXT Design", address: "1420 Washington Blvd #301, Detroit, MI 48226", lat: 42.325849, lng: -83.039468},
            {name: "NORR", address: "150 W Jefferson Ave Suite 1300, Detroit, MI 48226", lat: 42.330606, lng: -83.049696},
            {name: "M1DTW Architects", address: "1948 Division St, Detroit, MI 48207", lat: 42.355907, lng: -83.025448},
            {name: "Las Vegas Stone Flooring Inc", address: "11343 Schaefer Hwy, Detroit, MI 48227", lat: 42.380473, lng: -83.196137},
            {name: "Infuz Architects", address: "1451 Bagley St Suite 7, Detroit, MI 48216", lat: 42.316565, lng: -83.082713},
            {name: "Harris Design Group", address: "15 E Kirby St, Detroit, MI 48202", lat: 42.379338, lng: -83.074418},
            {name: "Hamilton Anderson Associates", address: "1435 Randolph Street #200, Detroit, MI 48226", lat: 42.334230, lng: -83.047806},
            {name: "Gensler", address: "1265 Griswold St, Detroit, MI 48226", lat: 42.341023, lng: -83.045076},
            {name: "Ferlito Group", address: "440 Selden St, Detroit, MI 48201", lat: 42.357685, lng: -83.073293},
            {name: "Et Al Collaborative of Detroit", address: "2020 14th St, Detroit, MI 48216", lat: 42.329408, lng: -83.096429},
            {name: "Drinks Design", address: "1051 Bellevue St, Detroit, MI 48207", lat: 42.359251, lng: -83.024691},
            {name: "Bedrock", address: "630 Woodward Ave, Detroit, MI 48226", lat: 42.323568, lng: -83.047109},
            {name: "Archive Design Studio", address: "615 Griswold St #916, Detroit, MI 48226", lat: 42.335971, lng: -83.049526},
            {name: "Albert Kahn Associates", address: "Inc.,Fisher Bldg, 3011 W Grand Blvd #1800, Detroit, MI 48202", lat: 42.372124, lng: -83.069772},
            {name: "Winton Flooring and Design", address: "8348 Richardson Rd, Commerce Township, MI 48382", lat: 42.567704, lng: -83.498468},
            {name: "Ultra Floors", address: "Inc.,40210 Hayes Rd, Clinton Township, MI 48038", lat: 42.605094, lng: -82.935824},
            {name: "SDA Architects", address: "42490 Garfield Rd Suite 204, Clinton Township, MI 48038", lat: 42.600034, lng: -82.931488},
            {name: "SBW Architects LLC", address: "36358 Garfield Rd, Clinton Township, MI 48035", lat: 42.580769, lng: -82.915611},
            {name: "Leonard C Carnaghi Inc", address: "24388 Sorrentino Ct, Clinton Township, MI 48035", lat: 42.584839, lng: -82.916587},
            {name: "Kulbacki Inc", address: "35480 Forton Ct, Clinton Township, MI 48035", lat: 42.577284, lng: -82.928601},
            {name: "Gable and Company", address: "39103 Garfield Rd, Clinton Township, MI 48038", lat: 42.613285, lng: -82.943396},
            {name: "Innoative Engineered Solutions", address: "17001 19 Mile Rd, Clinton Township, MI 48038", lat: 42.606278, lng: -82.933040},
            {name: "Complete Kitchen Design", address: "33827 Harper Ave, Clinton Township, MI 48035", lat: 42.584395, lng: -82.923994},
            {name: "Cabinets by Cantu", address: "44930 Vic Wertz Dr, Clinton Township, MI 48036", lat: 42.596186, lng: -82.901832},
            {name: "Advanced Landscape & Builders Supply Co.", address: "890 Rochester Rd, Clawson, MI 48017", lat: 42.528048, lng: -83.154087},
            {name: "Studio Fraifogl", address: "6825 Dixie Hwy, Village of Clarkston, MI 48346", lat: 42.712546, lng: -83.421591},
            {name: "Chris Morgan and Associates", address: "4435 Newcastle Dr, Village of Clarkston, MI 48348", lat: 42.748807, lng: -83.396454},
            {name: "Window PlusHome Pro USA", address: "6490 E 10 Mile Rd, Center Line, MI 48015", lat: 42.493056, lng: -83.024690},
            {name: "Quarry Gardens", address: "9376 Marine City Hwy, Casco, MI 48064", lat: 42.766019, lng: -82.739041},
            {name: "Advance Tile & Marble Inc - Tile Installation with Professional Installers", address: "3250 Church Rd, Casco, MI 48064", lat: 42.760008, lng: -82.744262},
            {name: "MWHS", address: "330 Enterprise Ct, Bloomfield Township, MI 48302", lat: 42.558598, lng: -83.268400},
            {name: "SLS Designs Inc", address: "43700 Woodward Ave, Bloomfield Township, MI 48302", lat: 42.563094, lng: -83.270700},
            {name: "Rariden Schumacher Mio & Co", address: "35980 Woodward Ave #150, Bloomfield Hills, MI 48304", lat: 42.548843, lng: -83.255726},
            {name: "Penske Automotive Group", address: "Inc.,2555 S Telegraph Rd, Bloomfield Hills, MI 48302", lat: 42.559464, lng: -83.261976},
            {name: "Marusich Architecture", address: "36880 Woodward Ave, Bloomfield Hills, MI 48304", lat: 42.555920, lng: -83.256606},
            {name: "Kojaian Management Corporation", address: "39400 Woodward Ave #250, Bloomfield Hills, MI 48304", lat: 42.541696, lng: -83.249691},
            {name: "Hunter Roberts Homes", address: "36800 Woodward Ave #200, Bloomfield Hills, MI 48304", lat: 42.552659, lng: -83.253296},
            {name: "Edward Rose & Sons", address: "38525 Woodward Ave, Bloomfield Hills, MI 48304", lat: 42.556368, lng: -83.244977},
            {name: "Dokan Construction", address: "42690 Woodward Ave, Bloomfield Hills, MI 48304", lat: 42.553456, lng: -83.255507},
            {name: "Contour Companies", address: "40950 Woodward Ave #300, Bloomfield Hills, MI 48304", lat: 42.543983, lng: -83.259511},
            {name: "McLeod Carpet One Floor & Home", address: "42598 Woodward Ave, Bloomfield Hills, MI 48304", lat: 42.544897, lng: -83.250497},
            {name: "111 S Old Woodward Ave", address: "111 S Old Woodward Ave, Birmingham, MI 48009", lat: 42.553695, lng: -83.219843},
            {name: "JSK Design", address: "31333 Southfield Rd, Beverly Hills, MI 48025", lat: 42.518289, lng: -83.217405},
            {name: "Saroki Architecture", address: "430 N Old Woodward Ave, Birmingham, MI 48009", lat: 42.540589, lng: -83.207373},
            {name: "Sanda Johnstone Design Association", address: "950 E Maple Rd, Birmingham, MI 48009", lat: 42.546588, lng: -83.216420},
            {name: "Ron & Roman LLC", address: "275 E Frank St, Birmingham, MI 48009", lat: 42.549821, lng: -83.221189},
            {name: "Posh Interior Studios", address: "107 Townsend St, Birmingham, MI 48009", lat: 42.551719, lng: -83.205899},
            {name: "Pazzi Inc", address: "395 E Maple Rd, Birmingham, MI 48009", lat: 42.538832, lng: -83.212797},
            {name: "NH Ziegelman Architects LLC", address: "800 N Old Woodward Ave, Birmingham, MI 48009", lat: 42.540218, lng: -83.202141},
            {name: "Michael Willoughby & Associates-Architects", address: "880 S Old Woodward Ave #210, Birmingham, MI 48009", lat: 42.547059, lng: -83.220296},
            {name: "Merien Daka Design Group", address: "187 S Old Woodward Ave # 250, Birmingham, MI 48009", lat: 42.541684, lng: -83.204333},
            {name: "Meg Corley Interiors", address: "2051 Villa Rd #105, Birmingham, MI 48009", lat: 42.545829, lng: -83.205272},
            {name: "McIntosh Poris Architects", address: "36801 Woodward Ave, Birmingham, MI 48009", lat: 42.550052, lng: -83.201542},
            {name: "Marianne Jones Interior Design", address: "2003 Cole St, Birmingham, MI 48009", lat: 42.548609, lng: -83.202299},
            {name: "Luckenbach Ziegelman Architects", address: "555 S Old Woodward Ave Suite 27L, Birmingham, MI 48009", lat: 42.554529, lng: -83.209047},
            {name: "Kevin Hart Associates", address: "405 S Eton St, Birmingham, MI 48009", lat: 42.551085, lng: -83.211204},
            {name: "Jeffrey King Interiors", address: "2253 Cole St, Birmingham, MI 48009", lat: 42.553311, lng: -83.210343},
            {name: "James Douglas Interiors LLC - Interior Designs", address: "2007 Cole St, Birmingham, MI 48009", lat: 42.554644, lng: -83.206427},
            {name: "Homework Interiors", address: "s Rail District, 2239 Cole St, Birmingham, MI 48009", lat: 42.546193, lng: -83.216116},
            {name: "Gregory Aerts & Associates", address: "132 N Old Woodward Ave, Birmingham, MI 48009", lat: 42.541645, lng: -83.208547},
            {name: "Glenda Meads Architects", address: "114 S Old Woodward Ave, Birmingham, MI 48009", lat: 42.552016, lng: -83.210874},
            {name: "Designs Unlimited Custom Cabinetry", address: "104 Willits St, Birmingham, MI 48009", lat: 42.549235, lng: -83.215808},
            {name: "DesignTeam Plus", address: "Inc.,975 E Maple Rd #210, Birmingham, MI 48009", lat: 42.538250, lng: -83.215585},
            {name: "De Giulio Kitchen Studio", address: "34222 Woodward Ave, Birmingham, MI 48009", lat: 42.542134, lng: -83.214906},
            {name: "Craig Steinhous & Associates Inc", address: "187 S Old Woodward Ave, Birmingham, MI 48009", lat: 42.547503, lng: -83.218533},
            {name: "Brookside Residences", address: "369 N Old Woodward Ave, Birmingham, MI 48009", lat: 42.541325, lng: -83.207421},
            {name: "Brian Neeper Architecture", address: "259 E Frank St, Birmingham, MI 48009", lat: 42.550828, lng: -83.220015},
            {name: "Birmingham Kitchen Baths", address: "363 E Maple Rd, Birmingham, MI 48009", lat: 42.544852, lng: -83.210448},
            {name: "PDC Designs", address: "31455 Southfield Rd, Beverly Hills, MI 48025", lat: 42.518315, lng: -83.225863},
            {name: "Kalabat Development & Construction", address: "31333 Southfield Rd Suite 250, Beverly Hills, MI 48025", lat: 42.518403, lng: -83.211903},
            {name: "Gala & Associates Inc", address: "31455 Southfield Rd # 202, Beverly Hills, MI 48025", lat: 42.521682, lng: -83.216090},
            {name: "William Ellis Co", address: "3311 12 Mile Rd #2, Berkley, MI 48072", lat: 42.507135, lng: -83.174688},
            {name: "D & S Contractors", address: "3500 W Eleven Mile Rd, Berkley, MI 48072", lat: 42.497608, lng: -83.189882},
            {name: "Cobblestone Kitchen & Bath", address: "3311 12 Mile Rd, Berkley, MI 48072", lat: 42.497035, lng: -83.174930},
            {name: "Avenue Group Real Estate", address: "2985 12 Mile Rd, Berkley, MI 48072", lat: 42.507069, lng: -83.170931},
            {name: "Finished Spaces LLC", address: "3300 Auburn Rd Suite #210, Auburn Hills, MI 48326", lat: 42.685880, lng: -83.229150},
            {name: "Fieldstone Architecture & Engineering", address: "3400 Auburn Rd #200, Auburn Hills, MI 48326", lat: 42.688423, lng: -83.232035},
            {name: "Romeo Kitchen & Bath LLC", address: "80720 Capac Rd, Armada, MI 48005", lat: 42.838611, lng: -82.889812},
            {name: "Designhaus Architecture", address: "3300 Auburn Rd Suite 300, Auburn Hills, MI 48326", lat: 42.686217, lng: -83.243520},
            {name: "Thompson-Phelan Group Inc", address: "9834 Dixie Hwy, Ira Township, MI 48023", lat: 42.666723, lng: -82.646417},
        ];

        // State variables
        let map;
        let markers = [];
        let locations = [];
        let zones = [];
        let currentUser = null;
        let isGuest = false;
        let editingIndex = null;
        let numZones = 25;
        let maxPerZone = 20;

        // Zone colors
        const zoneColors = [
            '#ef4444', '#f97316', '#f59e0b', '#eab308', '#84cc16',
            '#22c55e', '#10b981', '#14b8a6', '#06b6d4', '#0ea5e9',
            '#3b82f6', '#6366f1', '#8b5cf6', '#a855f7', '#d946ef',
            '#ec4899', '#f43f5e', '#fb7185', '#fda4af', '#fecdd3',
            '#86efac', '#4ade80', '#34d399', '#2dd4bf', '#22d3ee',
            '#38bdf8', '#60a5fa', '#818cf8', '#a78bfa', '#c084fc'
        ];

        // Initialize map
        function initMap() {
            map = L.map('map').setView([42.5, -83.1], 10);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
                maxZoom: 19
            }).addTo(map);
        }

        // K-means clustering
        function kMeans(data, k, maxIterations = 100) {
            if (data.length === 0) return [];
            k = Math.min(k, data.length);

            // Initialize centroids randomly
            let centroids = data.slice(0, k).map(d => ({lat: d.lat, lng: d.lng}));
            let assignments = new Array(data.length).fill(0);

            for (let iter = 0; iter < maxIterations; iter++) {
                // Assign points to nearest centroid
                let changed = false;
                for (let i = 0; i < data.length; i++) {
                    let minDist = Infinity;
                    let minIdx = 0;
                    for (let j = 0; j < k; j++) {
                        let dist = Math.pow(data[i].lat - centroids[j].lat, 2) + 
                                   Math.pow(data[i].lng - centroids[j].lng, 2);
                        if (dist < minDist) {
                            minDist = dist;
                            minIdx = j;
                        }
                    }
                    if (assignments[i] !== minIdx) {
                        assignments[i] = minIdx;
                        changed = true;
                    }
                }

                if (!changed) break;

                // Update centroids
                for (let j = 0; j < k; j++) {
                    let points = data.filter((_, i) => assignments[i] === j);
                    if (points.length > 0) {
                        centroids[j] = {
                            lat: points.reduce((s, p) => s + p.lat, 0) / points.length,
                            lng: points.reduce((s, p) => s + p.lng, 0) / points.length
                        };
                    }
                }
            }

            return assignments;
        }

        // Recalibrate zones
        function recalibrateZones() {
            if (locations.length === 0) return;

            // Adjust number of zones based on max per zone
            let idealZones = Math.ceil(locations.length / maxPerZone);
            let actualZones = Math.min(numZones, idealZones, locations.length);

            // Run k-means
            let assignments = kMeans(locations, actualZones);

            // Assign zones
            locations.forEach((loc, i) => {
                loc.zone = assignments[i];
            });

            // Create zone objects
            zones = [];
            for (let i = 0; i < actualZones; i++) {
                let zoneLocations = locations.filter(l => l.zone === i);
                if (zoneLocations.length > 0) {
                    zones.push({
                        id: i,
                        name: `Zone ${i + 1}`,
                        color: zoneColors[i % zoneColors.length],
                        count: zoneLocations.length
                    });
                }
            }

            updateMap();
            updateZoneLegend();
            renderLocations();
            saveUserData();
        }

        // Update map markers
        function updateMap() {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            // Add new markers
            locations.forEach((loc, index) => {
                let color = zones[loc.zone]?.color || '#6366f1';
                let icon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>`,
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });

                let marker = L.marker([loc.lat, loc.lng], {icon: icon})
                    .addTo(map)
                    .bindPopup(`
                        <div style="min-width: 200px;">
                            <strong>${loc.name}</strong><br>
                            <span style="color: #94a3b8; font-size: 12px;">${loc.address}</span><br>
                            <span style="color: ${color};">Zone ${loc.zone + 1}</span><br>
                            <button onclick="openEditFromMap(${index})" 
                                    style="margin-top: 8px; background: linear-gradient(135deg, #6366f1, #4f46e5); 
                                           color: white; border: none; padding: 6px 12px; border-radius: 6px; 
                                           cursor: pointer; font-size: 12px;">
                                Edit Location
                            </button>
                        </div>
                    `);
                markers.push(marker);
            });

            // Fit map to markers
            if (markers.length > 0) {
                let group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Update zone legend
        function updateZoneLegend() {
            let legend = document.getElementById('zoneLegend');
            legend.innerHTML = zones.map(z => `
                <div class="zone-label" style="background: ${z.color};" onclick="filterByZone(${z.id})">
                    ${z.name} <span class="zone-count">${z.count}</span>
                </div>
            `).join('');
        }

        // Render locations list
        function renderLocations() {
            let sortBy = document.getElementById('sortBy').value;
            let searchTerm = document.getElementById('searchInput').value.toLowerCase();

            let filtered = locations.filter(loc => 
                loc.name.toLowerCase().includes(searchTerm) || 
                loc.address.toLowerCase().includes(searchTerm)
            );

            filtered.sort((a, b) => {
                if (sortBy === 'name') return a.name.localeCompare(b.name);
                if (sortBy === 'zone') return a.zone - b.zone;
                if (sortBy === 'address') return a.address.localeCompare(b.address);
                return 0;
            });

            let list = document.getElementById('locationsList');
            list.innerHTML = filtered.map((loc, displayIdx) => {
                let realIndex = locations.indexOf(loc);
                let zoneColor = zones[loc.zone]?.color || '#6366f1';
                return `
                    <div class="location-row flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div style="width: 12px; height: 12px; background: ${zoneColor}; border-radius: 50%;"></div>
                            <div>
                                <div class="font-medium">${loc.name}</div>
                                <div class="text-sm text-gray-400">${loc.address}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs px-2 py-1 rounded" style="background: ${zoneColor}20; color: ${zoneColor};">
                                Zone ${loc.zone + 1}
                            </span>
                            <button onclick="openEdit(${realIndex})" class="btn-secondary px-3 py-1 rounded-lg text-xs">
                                Recalibrate
                            </button>
                            <button onclick="deleteLocation(${realIndex})" class="btn-secondary px-3 py-1 rounded-lg text-xs text-red-400 hover:bg-red-500/20">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter locations by zone
        function filterByZone(zoneId) {
            document.getElementById('searchInput').value = '';
            document.getElementById('sortBy').value = 'zone';
            let filtered = locations.filter(l => l.zone === zoneId);

            let list = document.getElementById('locationsList');
            let zoneColor = zones[zoneId]?.color || '#6366f1';
            list.innerHTML = filtered.map(loc => {
                let realIndex = locations.indexOf(loc);
                return `
                    <div class="location-row flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div style="width: 12px; height: 12px; background: ${zoneColor}; border-radius: 50%;"></div>
                            <div>
                                <div class="font-medium">${loc.name}</div>
                                <div class="text-sm text-gray-400">${loc.address}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs px-2 py-1 rounded" style="background: ${zoneColor}20; color: ${zoneColor};">
                                Zone ${loc.zone + 1}
                            </span>
                            <button onclick="openEdit(${realIndex})" class="btn-secondary px-3 py-1 rounded-lg text-xs">
                                Recalibrate
                            </button>
                            <button onclick="deleteLocation(${realIndex})" class="btn-secondary px-3 py-1 rounded-lg text-xs text-red-400 hover:bg-red-500/20">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Add "Show All" button
            list.innerHTML += `
                <button onclick="renderLocations()" class="btn-secondary w-full py-2 rounded-xl mt-4">
                    Show All Locations
                </button>
            `;
        }

        // Sort and filter handlers
        function sortLocations() {
            renderLocations();
        }

        function filterLocations() {
            renderLocations();
        }

        // Edit modal functions
        function openEdit(index) {
            editingIndex = index;
            let loc = locations[index];
            document.getElementById('editName').value = loc.name;
            document.getElementById('editAddress').value = loc.address;
            document.getElementById('editLat').value = loc.lat;
            document.getElementById('editLng').value = loc.lng;

            // Populate zone dropdown
            let zoneSelect = document.getElementById('editZone');
            zoneSelect.innerHTML = '<option value="auto">Auto-assign</option>' +
                zones.map(z => `<option value="${z.id}" ${loc.zone === z.id ? 'selected' : ''}>${z.name}</option>`).join('');

            document.getElementById('editModal').classList.add('active');
        }

        function openEditFromMap(index) {
            map.closePopup();
            openEdit(index);
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            editingIndex = null;
        }

        function saveEdit() {
            if (editingIndex === null) return;

            let loc = locations[editingIndex];
            loc.name = document.getElementById('editName').value;
            loc.address = document.getElementById('editAddress').value;
            loc.lat = parseFloat(document.getElementById('editLat').value);
            loc.lng = parseFloat(document.getElementById('editLng').value);

            let zoneValue = document.getElementById('editZone').value;
            if (zoneValue !== 'auto') {
                loc.zone = parseInt(zoneValue);
            }

            closeEditModal();

            if (zoneValue === 'auto') {
                recalibrateZones();
            } else {
                updateMap();
                updateZoneLegend();
                renderLocations();
                saveUserData();
            }
        }

        // Add modal functions
        function showAddModal() {
            document.getElementById('addName').value = '';
            document.getElementById('addAddress').value = '';
            document.getElementById('addLat').value = '';
            document.getElementById('addLng').value = '';

            let zoneSelect = document.getElementById('addZone');
            zoneSelect.innerHTML = '<option value="auto">Auto-assign</option>' +
                zones.map(z => `<option value="${z.id}">${z.name}</option>`).join('');

            document.getElementById('addModal').classList.add('active');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
        }

        async function addLocation() {
            let name = document.getElementById('addName').value;
            let address = document.getElementById('addAddress').value;
            let lat = document.getElementById('addLat').value;
            let lng = document.getElementById('addLng').value;
            let zoneValue = document.getElementById('addZone').value;

            if (!name || !address) {
                alert('Please enter name and address');
                return;
            }

            // If no coordinates, try to geocode (approximate)
            if (!lat || !lng) {
                // Use center of existing locations as approximation
                if (locations.length > 0) {
                    lat = locations.reduce((s, l) => s + l.lat, 0) / locations.length;
                    lng = locations.reduce((s, l) => s + l.lng, 0) / locations.length;
                    // Add small random offset
                    lat += (Math.random() - 0.5) * 0.02;
                    lng += (Math.random() - 0.5) * 0.02;
                } else {
                    lat = 42.5;
                    lng = -83.1;
                }
            }

            let newLoc = {
                name: name,
                address: address,
                lat: parseFloat(lat),
                lng: parseFloat(lng),
                zone: zoneValue === 'auto' ? 0 : parseInt(zoneValue)
            };

            locations.push(newLoc);
            closeAddModal();
            recalibrateZones();
        }

        // Delete location
        function deleteLocation(index) {
            if (confirm('Are you sure you want to delete this location?')) {
                locations.splice(index, 1);
                recalibrateZones();
            }
        }

        // Zone management
        function showZoneModal() {
            document.getElementById('zoneCount').value = numZones;
            document.getElementById('maxPerZone').value = maxPerZone;

            let zoneList = document.getElementById('zoneList');
            zoneList.innerHTML = zones.map(z => `
                <div class="flex items-center justify-between p-2 rounded" style="background: ${z.color}20;">
                    <span style="color: ${z.color};">${z.name}</span>
                    <span class="text-sm text-gray-400">${z.count} locations</span>
                </div>
            `).join('');

            document.getElementById('zoneModal').classList.add('active');
        }

        function closeZoneModal() {
            document.getElementById('zoneModal').classList.remove('active');
        }

        function applyZoneSettings() {
            numZones = parseInt(document.getElementById('zoneCount').value);
            maxPerZone = parseInt(document.getElementById('maxPerZone').value);
            closeZoneModal();
            recalibrateZones();
        }

        // Authentication functions
        function login() {
            let username = document.getElementById('loginUsername').value;
            let password = document.getElementById('loginPassword').value;

            if (username === 'chris' && password === 'beaver') {
                currentUser = 'chris';
                isGuest = false;
                loadUserData();
                showMainApp();
            } else {
                // Check stored accounts
                let accounts = JSON.parse(localStorage.getItem('zoneManagerAccounts') || '{}');
                if (accounts[username] && accounts[username] === password) {
                    currentUser = username;
                    isGuest = false;
                    loadUserData();
                    showMainApp();
                } else {
                    document.getElementById('loginError').textContent = 'Invalid credentials';
                    document.getElementById('loginError').classList.remove('hidden');
                }
            }
        }

        function continueAsGuest() {
            currentUser = 'guest_' + Date.now();
            isGuest = true;
            locations = [];
            showMainApp();
        }

        function showCreateAccount() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('createAccountModal').classList.add('active');
        }

        function backToLogin() {
            document.getElementById('createAccountModal').classList.remove('active');
            document.getElementById('loginModal').classList.add('active');
        }

        function createAccount() {
            let username = document.getElementById('newUsername').value;
            let password = document.getElementById('newPassword').value;
            let confirm = document.getElementById('confirmPassword').value;

            if (!username || !password) {
                document.getElementById('createError').textContent = 'Please fill all fields';
                document.getElementById('createError').classList.remove('hidden');
                return;
            }

            if (password !== confirm) {
                document.getElementById('createError').textContent = 'Passwords do not match';
                document.getElementById('createError').classList.remove('hidden');
                return;
            }

            if (username === 'chris') {
                document.getElementById('createError').textContent = 'Username already exists';
                document.getElementById('createError').classList.remove('hidden');
                return;
            }

            let accounts = JSON.parse(localStorage.getItem('zoneManagerAccounts') || '{}');
            if (accounts[username]) {
                document.getElementById('createError').textContent = 'Username already exists';
                document.getElementById('createError').classList.remove('hidden');
                return;
            }

            accounts[username] = password;
            localStorage.setItem('zoneManagerAccounts', JSON.stringify(accounts));

            currentUser = username;
            isGuest = false;
            locations = [];
            showMainApp();
        }

        function logout() {
            saveUserData();
            currentUser = null;
            isGuest = false;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginModal').classList.add('active');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('createAccountModal').classList.remove('active');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('currentUser').textContent = isGuest ? 'Guest' : currentUser;

            initMap();
            recalibrateZones();
        }

        // Data persistence
        function loadUserData() {
            if (currentUser === 'chris') {
                // Load preloaded data or saved modifications
                let savedData = localStorage.getItem('zoneManager_chris');
                if (savedData) {
                    let data = JSON.parse(savedData);
                    locations = data.locations || preloadedLocations.map(l => ({...l, zone: 0}));
                    numZones = data.numZones || 25;
                    maxPerZone = data.maxPerZone || 20;
                } else {
                    locations = preloadedLocations.map(l => ({...l, zone: 0}));
                }
            } else {
                let savedData = localStorage.getItem('zoneManager_' + currentUser);
                if (savedData) {
                    let data = JSON.parse(savedData);
                    locations = data.locations || [];
                    numZones = data.numZones || 25;
                    maxPerZone = data.maxPerZone || 20;
                } else {
                    locations = [];
                }
            }
        }

        function saveUserData() {
            if (isGuest) return;

            let data = {
                locations: locations,
                numZones: numZones,
                maxPerZone: maxPerZone
            };
            localStorage.setItem('zoneManager_' + currentUser, JSON.stringify(data));
        }

        // Handle enter key on login
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            document.getElementById('loginUsername').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
        });
    </script>
</body>
</html>
